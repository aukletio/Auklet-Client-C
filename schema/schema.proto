syntax = "proto2";
package schema;
option go_package = "github.com/ESG-USA/Auklet-Client-C/schema";

import "device/device.proto";

// Exit represents the termination of an app.
message Exit {
	optional string application = 1;
	optional string checksum = 2;
	optional string publicIP = 3;
	optional string id = 4;
	optional string timestamp = 5;
	optional int32 exitStatus = 6;
	optional string signal = 7;
	message StackFrame {
		optional uint64 functionAddress = 1;
		optional uint64 callSiteAddress = 2;
	}
	repeated StackFrame stackTrace = 8;
	optional string macAddressHash = 9;
	optional device.Metrics systemMetrics = 10;
}

message Profile {
	optional string application = 1;
	optional string checksum = 2;
	optional string publicIP = 3;
	optional string id = 4;
	optional int64 timestamp = 5; // Unix epoch milliseconds
	message Tree {
		optional uint64 functionAddress = 1;
		optional uint64 callSiteAddress = 2;
		optional uint32 nCalls = 3;
		optional uint32 nSamples = 4;
		repeated Tree callees = 5;
	}
	optional Tree tree = 6;
}


// AppLog is a message generated by an app for the purposes of remote monitoring
// by users.
message AppLog {
	optional string application = 1;
	optional string checksum = 2;
	optional string publicIP = 3;
	optional string id = 4;
	optional string timestamp = 5;
	optional bytes message = 6;
	optional string macAddressHash = 7;
	optional device.Metrics systemMetrics = 8;
}

// AgentLog is a log message generated by an agent; typically an error or info
// message.
message AgentLog {
	optional string level = 1;
	optional string message = 2;
}
